<script Configuration -src="https://unpkg.com/ace-builds">
    modulo.register('util', function getEditor(elem) {
        ace.config.set('basePath', 'https://unpkg.com/ace-builds/src-min-noconflict');
        return ace.edit(elem);
    });
</script>

<Component name="ModuloEditor">
    <Template>
        <x-EditorSidebar onoptionschange:=script.onOptionsChange></x-EditorSidebar>
        <x-FileEditor
            content="print('hello world')"
            name="example.py"
            profile="{{ state.options.editorProfile|default:'syntax' }}"
            theme="{{ state.options.editorTheme|default:'eclipse' }}"
        ></x-FileEditor>
    </Template>

    <State
        options:={}
    ></State>

    <Script>
        function prepareCallback() {
            // TODO
        }
        function onOptionsChange(setting, newValue) {
            state.options[setting] = newValue;
            //element.rerender();
        }
    </Script>

    <Style
        -src="/demos/editor/editorlib/ModuloEditor.css"
    ></Style>
</Component>

<Component name="FileBrowser">
    <Template
        -src="/demos/editor/editorlib/FileBrowser.html"
    ></Template>

    <State
        files:=[]
        all-files:=[]
        chroot
    ></State>

    <Script
        -src="/demos/editor/editorlib/FileBrowser.js"
    ></Script>

    <Style
        -src="/demos/editor/editorlib/FileBrowser.css"
    ></Style>
</Component>

<Component name="Btn">
    <Style
        -src="/demos/editor/editorlib/Btn.css"
    ></Style>
</Component>

<Component name="EditorSidebar">
    <Props
        onoptionschange
    ></Props>
    <Template
        -src="/demos/editor/editorlib/EditorSidebar.html"
    ></Template>
    <State
        visible:=false
        tab:=null
        tabs:=[]
        boxes:=[]
    ></State>
    <Script
        -src="/demos/editor/editorlib/EditorSidebar.js"
    ></Script>
    <Style
        -src="/demos/editor/editorlib/EditorSidebar.css"
    ></Style>
</Component>

<Component name="FileEditor" rerender="manual">
    <Props
        content
        url
        name
        path
        inode
    ></Props>
    <Template
        -src="/demos/editor/editorlib/FileEditor.html"
    ></Template>
    <State
        content=""
        loading:=false
        err:=null
    ></State>
    <Script
        -src="/demos/editor/editorlib/FileEditor.js"
    ></Script>
    <Style
        -src="/demos/editor/editorlib/FileEditor.css"
    ></Style>
</Component>

<Component name="FileEditorSettings">
    <Props
        onchange
    ></Props>
    <Template
        -src="/demos/editor/editorlib/FileEditorSettings.html"
    ></Template>
    <State
        profiles:=[]
        selected:=null
        theme:=null
    ></State>
    <Script
        -src="/demos/editor/editorlib/FileEditorSettings.js"
    ></Script>
    <Style
        -src="/demos/editor/editorlib/FileEditorSettings.css"
    ></Style>
</Component>

<Component name="Options">
    <Props
        options
        onchange
        value
    ></Props>
    <Template>
        {% for opt in props.options %}
            <div style="position: relative">
                {% if props.value == opt.name %}
                    <div class="right-square"></div>
                {% endif %}
                <x-Btn
                    @click:=props.onchange
                    payload="{{ opt.name }}"
                    style="position: relative"
                >{{ opt.label|default:opt.name|capfirst }}</x-Btn>
            </div>
        {% endfor %}
    </Template>
</Component>


<Component name="LayoutSettings">
    <Template>
        <h3>Layout</h3>
        <x-Options
            value="{{ state.layout }}"
            onchange:=script.setLayout
            options:=state.layouts
        ></x-Options>
    </Template>
    <State
        layout="center"
        layouts:=[]
    ></State>
    <Script>
        function initializedCallback() {
            state.layouts.push(...[
                { name: 'center' },
                { name: 'wide' },
                { name: 'full' },
            ]);
        }
        function setLayout(payload) {
            state.layout = payload;
            // HACK!
            const modEdit = document.querySelector('x-ModuloEditor');
            for (const { name } of state.layouts) {
                modEdit.classList.remove('layout--' + name);
            }
            modEdit.classList.add('layout--' + payload);
            element.rerender(); // because is callback
        }
    </Script>
    <Style>
        .right-square {
            position: absolute;
            right: 10px;
            top: -3px;
            z-index: 0;
            height: calc(100% + 6px);
            width: 80px;
            background: var(--m-highlight);
        }
    </Style>
</Component>

