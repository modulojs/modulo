<script Configuration -src="https://unpkg.com/ace-builds">
    modulo.register('util', function getEditor(elem) {
        ace.config.set('basePath', 'https://unpkg.com/ace-builds/src-min-noconflict');
        return ace.edit(elem);
    });
</script>

<Component name="ModuloEditor">
    <Template>
        <x-EditorSidebar></x-EditorSidebar>
        <x-FileEditor
            content="print('hello world')"
            name="example.py"
        ></x-FileEditor>
    </Template>
    <Style>
        /* TODO: Need to implement and/or document global state binding (e.g. store), before this hacky settings system can be fixed */
        :host { /* Center is default */
            --editor-width: 750px;
            display: grid;
            height: calc(100vh - 20px);
            box-sizing: border-box;
            grid-gap: 15px;
            grid-template-columns: 1fr var(--editor-width) 1fr;
        }

        :host.layout--wide {
            --editor-width: calc(100vw - 500px);
        }

        :host.layout--full {
            --editor-width: 100vw;
            display: block;
        }

        :host.layout--full .menu-button-holder > x-Btn {
            margin-bottom: -80px;
            font-size: 12px;
            text-shadow: none;
            font-weight: 200;
            line-height: 15px;
            height: 20px;
            width: 20px;
            border-radius: 0;
            background: white;
        }

        :host * {
            box-sizing: border-box;
        }
    </Style>
</Component>

<Component name="FileBrowser">
    <Template
        -src="/demos/editor/editorlib/FileBrowser.html"
    ></Template>

    <State
        files:=[]
        all-files:=[]
        chroot
    ></State>

    <Script
        -src="/demos/editor/editorlib/FileBrowser.js"
    ></Script>

    <Style
        -src="/demos/editor/editorlib/FileBrowser.css"
    ></Style>
</Component>

<Component name="Btn">
    <Style
        -src="/demos/editor/editorlib/Btn.css"
    ></Style>
</Component>

<Component name="EditorSidebar">
    <Template
        -src="/demos/editor/editorlib/EditorSidebar.html"
    ></Template>
    <State
        visible:=false
        tab:=null
        tabs:=[]
        boxes:=[]
    ></State>
    <Script
        -src="/demos/editor/editorlib/EditorSidebar.js"
    ></Script>
    <Style
        -src="/demos/editor/editorlib/EditorSidebar.css"
    ></Style>
</Component>

<Component name="FileEditor" rerender="manual">
    <Props
        content
        url
        name
        path
        inode
    ></Props>
    <Template>
        <h3>{{ props.name }}</h3>
        {% if state.err %}
            <p><strong>ERR:</strong> {{ state.err }}</p>
        {% elif state.loading %}
            <p><em>Loading...</em></p>
        {% else %}
            <div id="main_editor" [script.edit]>{{ props.content }}</div>
        {% endif %}
    </Template>
    <State
        content=""
        loading:=false
        err:=null
    ></State>
    <Script
        -src="/demos/editor/editorlib/FileEditor.js"
    ></Script>
    <Style
        -src="/demos/editor/editorlib/FileEditor.css"
    ></Style>
</Component>

<Component name="FileEditorSettings">
    <Template
        -src="/demos/editor/editorlib/FileEditorSettings.html"
    ></Template>
    <State
        profiles:=[]
        selected:=null
    ></State>
    <Script
        -src="/demos/editor/editorlib/FileEditorSettings.js"
    ></Script>
    <Style
        -src="/demos/editor/editorlib/FileEditorSettings.css"
    ></Style>
</Component>

<Component name="Options">
    <Props
        options
        onchange
        value
    ></Props>
    <Template>
        {% for opt in props.options %}
            <div style="position: relative">
                {% if props.value == opt.name %}
                    <div class="right-square"></div>
                {% endif %}
                <x-Btn
                    @click:=props.onchange
                    payload="{{ opt.name }}"
                    style="position: relative"
                >{{ opt.name|capfirst }}</x-Btn>
            </div>
        {% endfor %}
    </Template>
</Component>


<Component name="LayoutSettings">
    <Template>
        <h3>Layout</h3>
        <x-Options
            value="{{ state.layout }}"
            onchange:=script.setLayout
            options:=state.layouts
        ></x-Options>
    </Template>
    <State
        layout="center"
        layouts:=[]
    ></State>
    <Script>
        function initializedCallback() {
            state.layouts.push(...[
                { name: 'center' },
                { name: 'wide' },
                { name: 'full' },
            ]);
        }
        function setLayout(payload) {
            state.layout = payload;
            // HACK!
            const modEdit = document.querySelector('x-ModuloEditor');
            for (const { name } of state.layouts) {
                modEdit.classList.remove('layout--' + name);
            }
            modEdit.classList.add('layout--' + payload);
            element.rerender(); // because is callback
        }
    </Script>
    <Style>
        .right-square {
            position: absolute;
            right: 10px;
            top: -3px;
            z-index: 0;
            height: calc(100% + 6px);
            width: 80px;
            background: var(--m-highlight);
        }
    </Style>
</Component>

